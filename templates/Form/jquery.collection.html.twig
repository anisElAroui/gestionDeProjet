{#{% block form_widget %}#}
    {#<script>#}
        {#var $collectionHolder;#}

        {#// setup an "add a tag" link#}
        {#var $addRequirementLink = $('<a href="#" class="add_requirement_link">Add a highLevelRequirement</a>');#}
        {#var $newLinkLi = $('<li></li>').append($addRequirementLink);#}


        {#jQuery(document).ready(function() {#}
            {#// Get the ul that holds the collection of tags#}
            {#$collectionHolder = $('ul.requirements');#}

            {#// add the "add a highLevelRequirement" anchor and li to the tags ul#}
            {#$collectionHolder.append($newLinkLi);#}

            {#// count the current form inputs we have (e.g. 2), use that as the new#}
            {#// index when inserting a new item (e.g. 2)#}
            {#$collectionHolder.data('index', $collectionHolder.find(':input').length);#}

            {#$addRequirementLink.on('click', function(e) {#}
                {#// prevent the link from creating a "#" on the URL#}
                {#e.preventDefault();#}

                {#// add a new tag form (see next code block)#}
                {#addRequimentForm($collectionHolder, $newLinkLi);#}
            {#});#}

            {#function addRequimentForm($collectionHolder, $newLinkLi) {#}
                {#// Get the data-prototype explained earlier#}
                {#var prototype = $collectionHolder.data('prototype');#}

                {#// get the new index#}
                {#var index = $collectionHolder.data('index');#}

                {#var newForm = prototype;#}
                {#// You need this only if you didn't set 'label' => false in your tags field in TaskType#}
                {#// Replace '__name__label__' in the prototype's HTML to#}
                {#// instead be a number based on how many items we have#}
                {#//newForm = newForm.replace(/__name__label__/g, index);#}

                {#// Replace '__name__' in the prototype's HTML to#}
                {#// instead be a number based on how many items we have#}
                {#newForm = newForm.replace(/__name__/g, index);#}

                {#// increase the index with one for the next item#}
                {#$collectionHolder.data('index', index + 1);#}

                {#// Display the form in the page in an li, before the "Add a tag" link li#}
                {#var $newFormLi = $('<li></li>').append(newForm);#}
                {#$newLinkLi.before($newFormLi);#}
            {#}#}


        {#});#}

    {#</script>#}
    {#{% spaceless %}#}
    {#<div  class=" form-group">#}
        {#<label class="col-sm-3 control-label" ><span class="label label-primary">High Level Requirement</span></label>#}
        {#<div class="col-sm-7">#}
            {#<ul class="requirements" data-prototype="{{ form_widget(form.requirements.vars.prototype)|e('html_attr') }}"data-index="{{ form.requirements|length }}">#}
                {#{% for requirement in form.requirements %}#}

                    {#{{ form_widget(requirement.highLevelRequirement,  {'attr': {'required':'required','class':'form-control'} }) }}#}
                    {#{{ form_errors(requirement.highLevelRequirement) }}#}

                {#{% endfor %}#}

            {#</ul>#}
        {#</div>#}

    {#</div>#}

    {#{% endspaceless %}#}
{#{% endblock form_widget %}#}

{% block collection_widget %}
    {% spaceless %}
        {% if prototype is defined %}
            {% set attr = attr|merge({'data-prototype': form_row(prototype)}) %}
            {% set attr = attr|merge({'data-prototype-name': prototype.vars.name}) %}
        {% endif %}
        {% set attr = attr|merge({'data-allow-add': allow_add ? 1 : 0}) %}
        {% set attr = attr|merge({'data-allow-remove': allow_delete ? 1 : 0 }) %}
        {% set attr = attr|merge({'data-name-prefix': full_name}) %}
        {{ block('form_widget') }}
    {% endspaceless %}
{% endblock collection_widget %}